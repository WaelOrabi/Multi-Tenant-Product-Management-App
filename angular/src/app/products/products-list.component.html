<div class="page">
  <div class="toolbar">
    <input [(ngModel)]="filters.filterText" placeholder="Search products" />
    <select [(ngModel)]="filters.category">
      <option value="">All categories</option>
      <option *ngFor="let c of categories" [value]="c">{{ c }}</option>
    </select>
    <button (click)="reload()" [disabled]="loading">Search</button>
    <a class="primary" [routerLink]="['/products/create']">+ New Product</a>
  </div>

  <div *ngIf="loading" class="loading">Loading...</div>

  <div class="grid" *ngIf="!loading">
    <div class="card" *ngFor="let p of items">
      <div class="card-header">
        <div>
          <div class="title">{{ p.name }}</div>
          <div class="subtitle">{{ p.category || 'Uncategorized' }}</div>
        </div>
        <div class="actions">
          <a [routerLink]="['/products', p.id, 'edit']">Edit</a>
          <button class="danger" (click)="confirmDelete(p)">Delete</button>
        </div>
      </div>
      <div class="card-body">
        <div>{{ p.description }}</div>
        <div *ngIf="!p.hasVariants">Price: {{ p.basePrice | currency }}</div>
        <div *ngIf="p.hasVariants">Variants: {{ p.variants?.length || 0 }}</div>
      </div>
    </div>
  </div>

  <div class="pager">
    <button (click)="prev()" [disabled]="skipCount===0 || loading">Prev</button>
    <span>{{ skipCount + 1 }} - {{ Math.min(skipCount+pageSize, totalCount) }} / {{ totalCount }}</span>
    <button (click)="next()" [disabled]="skipCount+pageSize>=totalCount || loading">Next</button>
  </div>
</div>
